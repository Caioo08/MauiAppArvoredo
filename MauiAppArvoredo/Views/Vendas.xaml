<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiAppArvoredo.Views.Vendas"
             Title="Vendas"
             Shell.NavBarIsVisible="False">

    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#fae6c2" Offset="0.1"/>
            <GradientStop Color="#c68f56" Offset="0.4"/>
            <GradientStop Color="#b47b39" Offset="0.7"/>
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ===== HEADER ===== -->
        <Grid Grid.Row="0">
            <ImageButton Source="seta.png"
                         BackgroundColor="Transparent"
                         WidthRequest="40"
                         HeightRequest="40"
                         HorizontalOptions="Start"
                         VerticalOptions="Center"
                         Clicked="OnVoltarClicked"/>
            <Label Text="VENDAS"
                   FontFamily="GagalinRegular"
                   FontSize="28"
                   TextColor="#391b01"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
            <ImageButton Source="sincronizar_icon.png"
                         BackgroundColor="Transparent"
                         WidthRequest="35"
                         HeightRequest="35"
                         HorizontalOptions="End"
                         VerticalOptions="Center"
                         Clicked="OnSincronizarClicked"/>
        </Grid>

        <!-- ===== FILTROS ===== -->
        <Frame Grid.Row="1"
               BackgroundColor="#efd4ac"
               CornerRadius="15"
               Padding="15"
               Margin="0,10"
               HasShadow="False">
            <HorizontalStackLayout Spacing="10">
                <Label Text="Filtrar:"
                       FontSize="16"
                       TextColor="#391b01"
                       FontAttributes="Bold"
                       VerticalOptions="Center"/>
                <Button x:Name="btnTodas"
                        Text="Todas"
                        BackgroundColor="#391b01"
                        TextColor="White"
                        FontSize="12"
                        CornerRadius="10"
                        Padding="15,5"
                        Clicked="OnFiltroTodasClicked"/>
                <Button x:Name="btnPendentes"
                        Text="Pendentes"
                        BackgroundColor="Transparent"
                        TextColor="#391b01"
                        FontSize="12"
                        CornerRadius="10"
                        BorderColor="#391b01"
                        BorderWidth="1"
                        Padding="15,5"
                        Clicked="OnFiltroPendentesClicked"/>
                <Button x:Name="btnPagas"
                        Text="Pagas"
                        BackgroundColor="Transparent"
                        TextColor="#391b01"
                        FontSize="12"
                        CornerRadius="10"
                        BorderColor="#391b01"
                        BorderWidth="1"
                        Padding="15,5"
                        Clicked="OnFiltroPagasClicked"/>
            </HorizontalStackLayout>
        </Frame>

        <!-- ===== RESUMO ===== -->
        <Frame Grid.Row="2"
               BackgroundColor="#efd4ac"
               CornerRadius="15"
               Padding="15"
               Margin="0,0,0,10"
               HasShadow="False">
            <Grid ColumnDefinitions="*" ColumnSpacing="10">
                <VerticalStackLayout Grid.Column="2" Spacing="5">
                    <Label x:Name="lblVendasPendentes"
                           Text="0"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="Red"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="Pendentes"
                           FontSize="12"
                           TextColor="#391b01"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </Grid>
        </Frame>

        <!-- ===== LISTA DE VENDAS ===== -->
        <ScrollView Grid.Row="3">
            <CollectionView x:Name="ListaVendas"
                           SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="#efd4ac"
                               CornerRadius="15"
                               Padding="15"
                               Margin="0,0,0,10"
                               HasShadow="False">

                            <StackLayout Spacing="10">
                                <!-- Dados principais da venda -->
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto"
                                      ColumnDefinitions="*,Auto"
                                      RowSpacing="8">
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding NomeCliente}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="#391b01"/>
                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="{Binding StatusTexto}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="Red"
                                           HorizontalOptions="End"/>
                                    <Label Grid.Row="1" Grid.Column="0"
                                           Text="{Binding DataFormatada}"
                                           FontSize="14"
                                           TextColor="#391b01"
                                           Opacity="0.7"/>
                                    <Label Grid.Row="1" Grid.Column="1"
                                           Text="{Binding ValorFormatado}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="#391b01"
                                           HorizontalOptions="End"/>
                                    <Label Grid.Row="2" Grid.Column="0"
                                           Grid.ColumnSpan="2"
                                           FontSize="12"
                                           TextColor="#391b01"
                                           Opacity="0.6"
                                           >
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="ðŸ’³ "/>
                                                <Span Text="{Binding FormaPagamento}"/>
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label Grid.Row="3" Grid.Column="0"
                                           Grid.ColumnSpan="2"
                                           Text="{Binding Descricao}"
                                           FontSize="12"
                                           TextColor="#391b01"
                                           Opacity="0.5"
                                           LineBreakMode="TailTruncation"/>
                                </Grid>

                                <!-- Lista de itens da venda -->
                                <CollectionView ItemsSource="{Binding Itens}"
                                                SelectionMode="None">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                                                <Label Text="{Binding NomeProduto}" FontSize="12"/>
                                                <Label Text="{Binding Quantidade}" FontSize="12" HorizontalOptions="Center"/>
                                                <Label Text="{Binding ValorTotal, StringFormat='R$ {0:N2}'}" FontSize="12" HorizontalOptions="End"/>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </StackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <!-- Mensagem quando vazio -->
                <CollectionView.EmptyView>
                    <ContentView>
                        <VerticalStackLayout VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Padding="40">
                            <Label Text="ðŸ“¦"
                                   FontSize="60"
                                   HorizontalTextAlignment="Center"/>
                            <Label Text="Nenhuma venda encontrada"
                                   FontSize="18"
                                   TextColor="#391b01"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,10,0,0"/>
                            <Label x:Name="lblMensagemVazia"
                                   Text="Sincronize para carregar vendas da API"
                                   FontSize="14"
                                   TextColor="#391b01"
                                   Opacity="0.6"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,5,0,0"/>
                        </VerticalStackLayout>
                    </ContentView>
                </CollectionView.EmptyView>
            </CollectionView>
        </ScrollView>
    

    <!-- ===== LOADING OVERLAY ===== -->
    <Grid x:Name="LoadingOverlay"
          IsVisible="False"
          BackgroundColor="#80000000">
        <Frame BackgroundColor="#efd4ac"
               CornerRadius="20"
               Padding="30"
               WidthRequest="200"
               HeightRequest="150"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               HasShadow="True">
            <VerticalStackLayout Spacing="15"
                               HorizontalOptions="Center"
                               VerticalOptions="Center">
                <ActivityIndicator IsRunning="True"
                                   Color="#391b01"
                                   WidthRequest="40"
                                   HeightRequest="40"/>
                <Label x:Name="lblLoadingText"
                       Text="Carregando..."
                       FontSize="16"
                       TextColor="#391b01"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>
        </Frame>
    </Grid>
    </Grid>
</ContentPage>
